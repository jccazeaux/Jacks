/*! Jacks - v0.1.0 - 2015-06-28
 * https://github.com/jccazeaux/Jacks
 * Copyright (c) 2015 Jean-Christophe Cazeaux.
 * Licensed under the MIT license.
 */var jacks=function(){"use strict";function a(){function a(a,b){var c=j[b];if(void 0===c||null===c)throw"No serializer found for type "+b;return c(a)}function d(a,b){var c,d=a;if(c=d.indexOf("?")>0?"&":"?",null!=b)for(var e in b)d+=c+e+"="+encodeURIComponent(b[e]),c="&";return d}function f(a,b){this.xhr=a,this.url=b.url,this.status=a.status,this.statusText=a.statusText,this.responseText=a.responseText;var c=a.getResponseHeader("Content-Type");k[c]?this.response=k[c](a.responseText):this.response=a.responseText,this.headers=a.getAllResponseHeaders()}function g(a,b){this.type=a.type,this.url=b.url}function h(h,j){function k(){if(window.XMLHttpRequest)return(new XMLHttpRequest).upload?(b=2,x=o):(b=1,x=n),new XMLHttpRequest;b=1,x=n;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}return!1}function m(a,b,c){var d=function(){var d={responseText:c.responseText,getAllResponseHeaders:function(){return c.headers},getResponseHeader:function(a){return c.headers?c.headers[a]:null},status:c.status,statusText:c.statusText};p("open"),c.error&&setTimeout(function(){b(new g(c.error,y))},c.delay||0),setTimeout(function(){a(new f(d,y))},c.delay||0)};"function"==typeof c.response?0===c.response.length?(c.response(),d()):c.response(d):d()}function n(a,b){var c=y.xhr;c.onreadystatechange=function(){if(4==c.readyState){q();var d;try{d=c.status}catch(e){d=0}if(0!==d)a(new f(c,y));else{if(y.aborted)return b({type:"abort",url:y.url},y);if(y.timedout)return b({type:"timeout",url:y.url},y)}}},c.onerror=function(a){b(new g(a,y),y)},c.open(h,y.url,w),p("open");for(var d in t)c.setRequestHeader(d,t[d])}function o(a,b){var c=y.xhr;c.onload=function(){q();var d;try{d=c.status}catch(e){d=0}if(0!==d)a(new f(c,y));else{if(y.aborted)return b({type:"abort",url:y.url},y);if(y.timedout)return b({type:"timeout",url:y.url},y)}},c.onerror=function(a){b(new g(a,y),y)},c.onprogress=function(a){p("progress",a)},c.onabort=function(a){p("abort",a)},c.ontimeout=function(a){p("timeout",a)},c.onloadstart=function(a){p("loadstart",a)},c.onloadend=function(a){p("loadend",a)},c.upload.onprogress=function(a){p("upload-progress",a)},c.open(h,y.url,w),p("open");for(var d in t)c.setRequestHeader(d,t[d])}function p(a,b){var c=l[a];if(c)for(var d=0;d<c.length;d++)c[d](b)}function q(){s&&(clearTimeout(s),s=null)}function r(){var a;for(var b in c){a=c[b];var d=!1;if(d=a.request.url instanceof RegExp?a.request.url.test(y.url):a.request.url===y.url,d&&(!a.request.method||a.request.method.toUpperCase()===y.requestType.toUpperCase()))return a.response}}var s=null,t={},u=null,v=null,w=!0;this.requestType=h,this.url=j,this.xhr=k();var x,y=this;this.header=function(a,b){return void 0===a?t:(t[a]=b,this)},this.body=function(a){return void 0===name?u:(u=a,this)},this.sync=function(){return w=!1,this},this.query=function(a,b){if(void 0===a)return v;if(v=v||{},"string"==typeof a){v[a]=b;var c={};c[a]=b,y.url=d(y.url,c)}else if("object"==typeof a)for(var e in a)v[e]=a[e],y.url=d(y.url,a);return this},this.use=function(a){if("string"==typeof a){if(null==e[a])throw"Plugin "+i[z]+" not found";e[a](this)}else"function"==typeof a&&a(this);return this},this.send=function(b,c){var d=r();if(d)return m(b,c,d),this;x(b,c);var e=null;return e=null!=u&&"object"==typeof u?a(u,t["Content-Type"]):u,this.xhr.send(e),p("send"),this},this.sendAsbinary=function(b,c){var d=r();if(d)return m(b,c,d),this;x(b,c);var e=null;return e=null!=u&&"object"==typeof u?a(u,t["Content-Type"]):u,xhr.sendAsBinary(e),p("send"),this},this.abort=function(){return this.aborted=!0,p("abort"),this.xhr.abort(),this},this.timeout=function(a){return setTimeout(function(){p("timeout"),this.timedout=!0,this.xhr.abort()},a),this},this.on=function(a,b){return l[a]=l[a]||[],l[a].push(b),this};for(var z=0;z<i.length;z++)this.use(i[z])}var i=[],j={"application/json":function(a){return JSON.stringify(a)},"application/x-www-form-urlencoded":function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}},k={"application/json":function(a){return JSON.parse(a)}},l={};return this.get=function(a){return new h("GET",a)},this.post=function(a){return new h("POST",a)},this.put=function(a){return new h("PUT",a)},this.options=function(a){return new h("OPTIONS",a)},this.head=function(a){return new h("HEAD",a)},this["delete"]=function(a){return new h("DELETE",a)},this.use=function(a){return i.push(a),this},this.parser=function(a,b){return k[a]=b,this},this.serializer=function(a,b){return j[a]=b,this},this}var b,c=[],d=function(){return new a},e={};return d.plugin=function(a,b){return e[a]=b,this},d.mock=function(a,b){return c.push({request:a,response:b}),this},d.clearMocks=function(){return c=[],this},d}();window.jacks=jacks;